(()=>{"use strict";var e={396:(e,t,r)=>{r.r(t)},608:(e,t,r)=>{r.r(t)},270:function(e,t,r){var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(i,a){function c(e){try{o(s.next(e))}catch(e){a(e)}}function n(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,n)}o((s=s.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(382)),c=i(r(130));t.default=class{constructor(){this.state={url:"https://makeup-api.herokuapp.com/api/v1/products.json"}}start(){return s(this,void 0,void 0,(function*(){const e=new a.default(this.state),t=yield e.getProductsValues(),r=e.extractUniqueValues(t,"brand"),s=e.extractUniqueValues(t,"category"),i=e.extractUniqueValues(t,"product_type"),n=new c.default(t,r,s,i);n.render(),n.addCheckboxFilter("brands"),n.addCheckboxFilter("categories"),n.addCheckboxFilter("types"),n.checkCart(),n.search(),n.reset(),n.loadSettings()}))}}},607:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(270));r(396),(new i.default).start()},382:function(e,t){var r=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(i,a){function c(e){try{o(s.next(e))}catch(e){a(e)}}function n(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(c,n)}o((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this.state=e}static extractProducts(e){return e}extractUniqueValues(e,t){const r=[];return e.forEach((e=>{r.push(e[`${t}`]?e[`${t}`]:"other")})),new Set(r)}getProductsValues(){return r(this,void 0,void 0,(function*(){const{url:e}=this.state;try{const t=yield fetch(e),r=yield t.json();return s.extractProducts(r)}catch(e){throw new Error("Один из запросов завершился неудачно =(")}}))}}t.default=s},647:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(553));t.default=class{constructor(e,t,r,s){this.cart={},this.products=e,this.brands=t,this.categories=r,this.types=s,this.sortDateSwitcher=!0,this.sortNameSwitcher=!0,this.checked={brands:[],categories:[],types:[]},this.priceRangeSlider=new i.default(this.products,this.brands,this.categories,this.types,"price"),this.ratingRangeSlider=new i.default(this.products,this.brands,this.categories,this.types,"rating")}render(){const e=document.querySelector(".cards");e.innerHTML="",this.products.forEach((t=>{const r=t.name.replace(new RegExp(`${t.brand}`,"gi"),"").replace(/[^a-zA-Zа-яА-Я0-9 ]/iu,"").trim().toLowerCase(),s=new Date(t.created_at).toLocaleString("en-US",{year:"numeric",month:"long"}),i=t.price&&"0.0"!==t.price,a=i?t.price:"",c=t.rating?t.rating:"0",n=t.brand?t.brand.replace("_"," "):"other",o=t.category?t.category.replace("_"," "):"other",l=t.product_type.replace("_"," "),d=document.createElement("article");d.className="cards__item card",d.setAttribute("data-enter",t.created_at),d.setAttribute("data-id",t.id),d.innerHTML=`\n      <div class="card__img-wrapper">\n        <img class="card__img" src='${t.api_featured_image}' alt='${t.name}'>\n      </div>\n      <h2 class="card__name">${r}</h2>\n      <p class="card__enter">Release date: ${s}</p>\n      <p class="card__brands">Brand: ${n}</p>\n      <p class="card__categories">Category: ${o}</p>\n      <p class="card__types">Type: ${l}</p>\n      <p class="card__available">${i?"Available":"Not available"}</p>\n      <div class="card__rating">Rating: ${c}</div>\n      <p class="card__price">${a} ${i?"$":""}</p>\n      ${i?'<button class="card__btn" data-id="'+t.id+'">BUY</button>':""}`,e.append(d);const h=d.querySelector(".card__btn");h&&h.addEventListener("click",(e=>{d.classList.toggle("cards__item_checked");const t=e.target,r=t.getAttribute("data-id");r&&this.addToCart(r,t),this.showMiniCart()})),this.priceRangeSlider.initSlider(),this.ratingRangeSlider.initSlider()})),document.querySelector(".filter-order__date-link").addEventListener("click",this.sortByDate),document.querySelector(".filter-order__name-link").addEventListener("click",this.sortByName),this.priceRangeSlider.initSlider()}addCheckboxFilter(e){const t=document.querySelector(`.filter__${e}-sort`);t.innerHTML="";const r=document.createElement("h3");r.classList.add("filter-sort__subtitle"),r.classList.add("filter-subtitle"),r.innerHTML=`${e}:`,t.append(r);const s=document.createElement("ul");s.classList.add("filter-sort__list"),t.append(s);const i=document.createElement("li");i.classList.add("filter-sort__item"),i.innerHTML=`<label class="filter-sort__label-${e}">\n    <input class="filter-sort__input-${e}" type="checkbox" id="${e}-all" checked>all\n    </label>`,s.appendChild(i);const a=t=>{const r=t.target;this.sortByCheckbox(r,e),this.saveSettings()},c=i.querySelector(`.filter-sort__input-${e}`);c.addEventListener("click",a);const n={brands:this.brands,categories:this.categories,types:this.types};Array.from(n[`${e}`]).sort().map((t=>{const r=document.createElement("li");r.classList.add("filter-sort__item"),r.innerHTML=`<label class="filter-sort__label-${e}">\n        <input class="filter-sort__input-${e}" type="checkbox"\n        id="${e+"-"+t.replace("_"," ")}">${t.replace("_"," ")}\n        </label>`,s.appendChild(r),c.addEventListener("click",a)}))}sortByCheckbox(e,t){const r=document.querySelectorAll(".card"),s=document.querySelectorAll(`.filter-sort__input-${t}`),i=e.parentNode.textContent.toLowerCase().trim();e.checked?"all"!=i?this.checked[`${t}`].push(i):(this.checked[`${t}`].length=0,s.forEach((e=>{const r=e.parentNode.textContent.toLowerCase().trim();"all"!=r&&this.checked[`${t}`].push(r)}))):"all"!=i?this.checked[`${t}`].splice(this.checked[`${t}`].indexOf(i),1):(this.checked[`${t}`].length=0,s.forEach((e=>{const r=e.parentNode.textContent.toLowerCase().trim();"all"!=r&&e.checked&&this.checked[`${t}`].push(r)}))),r.forEach((e=>{const r=e.querySelector(`.card__${t}`).textContent.toLowerCase().split(":")[1].trim();this.checked[`${t}`].includes(r)?e.classList.remove(`hide-${t}`):e.classList.add(`hide-${t}`)}))}sortByDate(){const e={forward:function(e,t){return+e-+t},back:function(e,t){return+t-+e}},t=document.querySelectorAll(".card"),r=document.querySelector(".cards"),s={};t.forEach(((e,t)=>{const r=new Date(e.getAttribute("data-enter")).getTime();"none"!=e.style.display&&(s[r]={element:e,index:t})}));const i=Object.keys(s);(()=>{this.sortDateSwitcher=!this.sortDateSwitcher,i.sort(e[this.sortDateSwitcher?"forward":"back"])})(),i.map((e=>r.insertAdjacentElement("beforeend",s[e].element)))}sortByName(){const e={forward:(e,t)=>e<t?-1:e>t?1:0,back:(e,t)=>e>t?-1:e<t?1:0},t=document.querySelectorAll(".card"),r=document.querySelector(".cards"),s={};let i=0;t.forEach((function(e,t){const r=e.querySelector(".card__name").textContent;"none"!=e.style.display&&(Object.prototype.hasOwnProperty.call(s,`${r}`)?s[r+ ++i]={element:e,index:t}:s[r]={element:e,index:t})}));const a=Object.keys(s);(()=>{this.sortNameSwitcher=!this.sortNameSwitcher,a.sort(e[this.sortNameSwitcher?"forward":"back"])})(),a.map((e=>r.insertAdjacentElement("beforeend",s[e].element)))}addToCart(e,t){var r;!Object.keys(this.cart).length&&e?this.cart[e]=1:Object.keys(this.cart).length&&e&&this.cart[e]?this.cart[e]=0:Object.values(this.cart).reduce(((e,t)=>e+t))<20?this.cart[e]&&0!=this.cart[e]||(this.cart[e]=1):(alert("Sorry, all slots are full"),null===(r=t.closest(".card"))||void 0===r||r.classList.remove("cards__item_checked")),localStorage.setItem("cart",JSON.stringify(this.cart))}checkCart(){const e=localStorage.getItem("cart");e&&(this.cart=JSON.parse(e)),this.showMiniCart(),document.querySelectorAll(".card").forEach((e=>{const t=e.getAttribute("data-id");this.cart[t]&&0!=this.cart[t]&&e.classList.add("cards__item_checked")}))}showMiniCart(){let e=0;const t=document.querySelector(".mini-cart__counter");for(const t in this.cart)e+=this.cart[t];t.textContent=String(e)}search(){document.querySelector(".search__input").addEventListener("input",(function(){const e=this.value.toLowerCase().trim();document.querySelectorAll(".card").forEach((t=>{const r=t.querySelector(".card__name").textContent.search(e);""!==e&&-1==r?t.classList.add("hide-search"):t.classList.remove("hide-search")}))}))}reset(){const e=document.getElementById("filters"),t=document.getElementById("search"),r=document.querySelector(".filter__reset-btn"),s=document.querySelector(".filter__clear-btn");null==r||r.addEventListener("click",(()=>{t.reset(),null==e||e.reset()})),null==s||s.addEventListener("click",(()=>{localStorage.clear(),location.reload()}))}saveSettings(){const e=document.getElementById("filters"),t={};Array.from(e.elements).forEach((e=>{"checkbox"!=e.type&&(t[e.id]=e.value),"range"!=e.type&&"text"!=e.type&&(t[e.id]=e.checked)})),localStorage.setItem("form",JSON.stringify(t))}loadSettings(){const e=document.getElementById("filters"),t=JSON.parse(localStorage.getItem("form"));t&&(Array.from(e.elements).forEach((e=>{"checkbox"!=e.type&&(e.value=t[e.id],"range"!=e.type&&"text"!=e.type&&(e.checked=t[e.id],t[e.id]&&this.sortByCheckbox(e,e.getAttribute("id").split("-")[0])))})),this.priceRangeSlider.initSlider(),this.ratingRangeSlider.initSlider())}}},130:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(647));r(608),t.default=i.default},553:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(r(647));class a extends i.default{constructor(e,t,r,s,i){super(e,t,r,s),this.name=i,this.minGap=0,this.cards=document.querySelectorAll(".card")}initSlider(){this.sliderFrom=document.getElementById(`${this.name}-slider-from`),this.sliderTo=document.getElementById(`${this.name}-slider-to`),this.valFrom=document.getElementById(`${this.name}-from`),this.valTo=document.getElementById(`${this.name}-to`),this.sliderTrack=document.getElementById(`${this.name}-slider-track`),this.slideOne(),this.sliderFrom.addEventListener("input",(()=>{this.slideOne(),this.saveSettings()})),this.slideTwo(),this.sliderTo.addEventListener("input",(()=>{this.slideTwo(),this.saveSettings()}))}slideOne(){this.sliderFrom&&this.sliderTo&&this.valFrom&&this.valTo&&(parseInt(this.sliderTo.value)-parseInt(this.sliderFrom.value)<=this.minGap&&(this.sliderFrom.value=String(parseInt(this.sliderTo.value)-this.minGap)),this.valFrom.value=this.sliderFrom.value,this.fillColor(),"price"==this.name&&this.cards.forEach((e=>{const t=+e.querySelector(".card__price").textContent.replace("$","").trim();this.sliderFrom&&t<+this.sliderFrom.value&&e.classList.add("hide-price"),this.sliderFrom&&this.sliderTo&&t>=+this.sliderFrom.value&&t<=+this.sliderTo.value&&e.classList.remove("hide-price")})),"rating"==this.name&&this.cards.forEach((e=>{const t=+e.querySelector(".card__rating").textContent.replace("Rating:","").trim();this.sliderFrom&&t<+this.sliderFrom.value&&e.classList.add("hide-rating"),this.sliderFrom&&this.sliderTo&&t>=+this.sliderFrom.value&&t<=+this.sliderTo.value&&e.classList.remove("hide-rating")})))}slideTwo(){this.sliderFrom&&this.sliderTo&&this.valFrom&&this.valTo&&(parseInt(this.sliderTo.value)-parseInt(this.sliderFrom.value)<=this.minGap&&(this.sliderTo.value=String(parseInt(this.sliderFrom.value)+this.minGap)),this.valTo.value=this.sliderTo.value,this.fillColor(),"price"==this.name&&this.cards.forEach((e=>{const t=+e.querySelector(".card__price").textContent.replace("$","").trim();this.sliderTo&&t>+this.sliderTo.value&&e.classList.add("hide-price"),this.sliderFrom&&this.sliderTo&&t<=+this.sliderTo.value&&t>=+this.sliderFrom.value&&e.classList.remove("hide-price")})),"rating"==this.name&&this.cards.forEach((e=>{const t=+e.querySelector(".card__rating").textContent.replace("Rating:","").trim();this.sliderTo&&t>+this.sliderTo.value&&e.classList.add("hide-rating"),this.sliderFrom&&this.sliderTo&&t<=+this.sliderTo.value&&t>=+this.sliderFrom.value&&e.classList.remove("hide-rating")})))}fillColor(){if(this.sliderFrom&&this.sliderTo&&this.sliderTrack){const e=+this.sliderFrom.value/+this.sliderFrom.max*100,t=+this.sliderTo.value/+this.sliderFrom.max*100;this.sliderTrack.style.background=`linear-gradient(to right, #dadae5 ${e}%\n\n        , #9b8d64 ${e}% , #9b8d64 ${t}%, #dadae5 ${t}%)`}}}t.default=a}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,r),a.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(607)})();