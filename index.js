(()=>{"use strict";var e={396:(e,t,r)=>{r.r(t)},608:(e,t,r)=>{r.r(t)},270:function(e,t,r){var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(c,s){function n(e){try{o(a.next(e))}catch(e){s(e)}}function i(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?c(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,i)}o((a=a.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=c(r(382)),n=c(r(130));t.default=class{constructor(){this.state={url:"https://makeup-api.herokuapp.com/api/v1/products.json"}}start(){return a(this,void 0,void 0,(function*(){const e=new s.default(this.state),t=yield e.getProductsValues(),r=e.extractUniqueValues(t,"brand"),a=e.extractUniqueValues(t,"category"),c=e.extractUniqueValues(t,"product_type"),i=new n.default(t,r,a,c);i.render(),i.initSlider("price"),i.initSlider("rating"),i.addCheckboxFilter("brands"),i.addCheckboxFilter("categories"),i.addCheckboxFilter("types"),i.checkCart(),i.search(),i.reset(),i.loadSettings()}))}}},607:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=a(r(270));r(396),(new c.default).start()},382:function(e,t){var r=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(c,s){function n(e){try{o(a.next(e))}catch(e){s(e)}}function i(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?c(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,i)}o((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class a{constructor(e){this.state=e}static extractProducts(e){return e}extractUniqueValues(e,t){const r=[];return e.forEach((e=>{r.push(e[`${t}`]?e[`${t}`]:"other")})),new Set(r)}getProductsValues(){return r(this,void 0,void 0,(function*(){const{url:e}=this.state;try{const t=yield fetch(e),r=yield t.json();return a.extractProducts(r)}catch(e){throw new Error("Один из запросов завершился неудачно =(")}}))}}t.default=a},647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,r,a){this.cart={},this.products=e,this.brands=t,this.categories=r,this.types=a,this.sortDateSwitcher=!0,this.sortNameSwitcher=!0,this.checked={brands:[],categories:[],types:[]}}render(){const e=document.querySelector(".cards");e.innerHTML="",this.products.forEach((t=>{const r=t.name.replace(new RegExp(`${t.brand}`,"gi"),"").replace(/[^a-zA-Zа-яА-Я0-9 ]/iu,"").trim().toLowerCase(),a=new Date(t.created_at).toLocaleString("en-US",{year:"numeric",month:"long"}),c=t.price&&"0.0"!==t.price,s=c?t.price:"",n=t.rating?t.rating:"0",i=t.brand?t.brand.replace("_"," "):"other",o=t.category?t.category.replace("_"," "):"other",l=t.product_type.replace("_"," "),d=document.createElement("article");d.className="cards__item card",d.setAttribute("data-enter",t.created_at),d.setAttribute("data-id",t.id),d.innerHTML=`\n      <div class="card__img-wrapper">\n        <img class="card__img" src='${t.api_featured_image}' alt='${t.name}'>\n      </div>\n      <h2 class="card__name">${r}</h2>\n      <p class="card__enter">Release date: ${a}</p>\n      <p class="card__brands">Brand: ${i}</p>\n      <p class="card__categories">Category: ${o}</p>\n      <p class="card__types">Type: ${l}</p>\n      <p class="card__available">${c?"Available":"Not available"}</p>\n      <div class="card__rating">Rating: ${n}</div>\n      <p class="card__price">${s} ${c?"$":""}</p>\n      ${c?'<button class="card__btn" data-id="'+t.id+'">BUY</button>':""}`,e.append(d);const u=d.querySelector(".card__btn");u&&u.addEventListener("click",(e=>{d.classList.toggle("cards__item_checked");const t=e.target,r=t.getAttribute("data-id");r&&this.addToCart(r,t),this.showMiniCart()}))})),document.querySelector(".filter-order__date-link").addEventListener("click",this.sortByDate),document.querySelector(".filter-order__name-link").addEventListener("click",this.sortByName)}addCheckboxFilter(e){const t=document.querySelector(`.filter__${e}-sort`);t.innerHTML="";const r=document.createElement("h3");r.classList.add("filter-sort__subtitle"),r.classList.add("filter-subtitle"),r.innerHTML=`${e}:`,t.append(r);const a=document.createElement("ul");a.classList.add("filter-sort__list"),t.append(a);const c=document.createElement("li");c.classList.add("filter-sort__item"),c.innerHTML=`<label class="filter-sort__label-${e}">\n    <input class="filter-sort__input-${e}" type="checkbox" id="${e}-all" checked>all\n    </label>`,a.appendChild(c);const s=t=>{const r=t.target;this.sortByCheckbox(r,e),this.saveSettings()},n=c.querySelector(`.filter-sort__input-${e}`);n.addEventListener("click",s);const i={brands:this.brands,categories:this.categories,types:this.types};Array.from(i[`${e}`]).sort().map((t=>{const r=document.createElement("li");r.classList.add("filter-sort__item"),r.innerHTML=`<label class="filter-sort__label-${e}">\n        <input class="filter-sort__input-${e}" type="checkbox"\n        id="${e+"-"+t.replace("_"," ")}">${t.replace("_"," ")}\n        </label>`,a.appendChild(r),n.addEventListener("click",s)}))}sortByCheckbox(e,t){const r=document.querySelectorAll(".card"),a=document.querySelectorAll(`.filter-sort__input-${t}`),c=e.parentNode.textContent.toLowerCase().trim();e.checked?"all"!=c?this.checked[`${t}`].push(c):(this.checked[`${t}`].length=0,a.forEach((e=>{const r=e.parentNode.textContent.toLowerCase().trim();"all"!=r&&this.checked[`${t}`].push(r)}))):"all"!=c?this.checked[`${t}`].splice(this.checked[`${t}`].indexOf(c),1):(this.checked[`${t}`].length=0,a.forEach((e=>{const r=e.parentNode.textContent.toLowerCase().trim();"all"!=r&&e.checked&&this.checked[`${t}`].push(r)}))),r.forEach((e=>{const r=e.querySelector(`.card__${t}`).textContent.toLowerCase().split(":")[1].trim();this.checked[`${t}`].includes(r)?e.classList.remove(`hide-${t}`):e.classList.add(`hide-${t}`)}))}sortByDate(){const e={forward:function(e,t){return+e-+t},back:function(e,t){return+t-+e}},t=document.querySelectorAll(".card"),r=document.querySelector(".cards"),a={};t.forEach(((e,t)=>{const r=new Date(e.getAttribute("data-enter")).getTime();"none"!=e.style.display&&(a[r]={element:e,index:t})}));const c=Object.keys(a);(()=>{this.sortDateSwitcher=!this.sortDateSwitcher,c.sort(e[this.sortDateSwitcher?"forward":"back"])})(),c.map((e=>r.insertAdjacentElement("beforeend",a[e].element)))}sortByName(){const e={forward:(e,t)=>e<t?-1:e>t?1:0,back:(e,t)=>e>t?-1:e<t?1:0},t=document.querySelectorAll(".card"),r=document.querySelector(".cards"),a={};let c=0;t.forEach((function(e,t){const r=e.querySelector(".card__name").textContent;"none"!=e.style.display&&(Object.prototype.hasOwnProperty.call(a,`${r}`)?a[r+ ++c]={element:e,index:t}:a[r]={element:e,index:t})}));const s=Object.keys(a);(()=>{this.sortNameSwitcher=!this.sortNameSwitcher,s.sort(e[this.sortNameSwitcher?"forward":"back"])})(),s.map((e=>r.insertAdjacentElement("beforeend",a[e].element)))}initSlider(e){const t=document.getElementById(`${e}-slider-from`),r=document.getElementById(`${e}-slider-to`),a=document.getElementById(`${e}-from`),c=document.getElementById(`${e}-to`),s=document.getElementById(`${e}-slider-track`);this.slideOne(e,t,r,a,0,s),t.addEventListener("input",(()=>{this.slideOne(e,t,r,a,0,s),this.saveSettings()})),this.slideTwo(e,t,r,c,0,s),r.addEventListener("input",(()=>{this.slideTwo(e,t,r,c,0,s),this.saveSettings()}))}slideOne(e,t,r,a,c,s){const n=document.querySelectorAll(".card");parseInt(r.value)-parseInt(t.value)<=c&&(t.value=String(parseInt(r.value)-c)),a.value=t.value,this.fillColor(t,r,s),"price"==e&&n.forEach((e=>{const a=+e.querySelector(".card__price").textContent.replace("$","").trim();a<+t.value&&e.classList.add("hide-price"),a>=+t.value&&a<=+r.value&&e.classList.remove("hide-price")})),"rating"==e&&n.forEach((e=>{const a=+e.querySelector(".card__rating").textContent.replace("Rating:","").trim();a<+t.value&&e.classList.add("hide-rating"),a>=+t.value&&a<=+r.value&&e.classList.remove("hide-rating")}))}slideTwo(e,t,r,a,c,s){const n=document.querySelectorAll(".card");parseInt(r.value)-parseInt(t.value)<=c&&(r.value=String(parseInt(t.value)+c)),a.value=r.value,this.fillColor(t,r,s),"price"==e&&n.forEach((e=>{const a=+e.querySelector(".card__price").textContent.replace("$","").trim();a>+r.value&&e.classList.add("hide-price"),a<=+r.value&&a>=+t.value&&e.classList.remove("hide-price")})),"rating"==e&&n.forEach((e=>{const a=+e.querySelector(".card__rating").textContent.replace("Rating:","").trim();a>+r.value&&e.classList.add("hide-rating"),a<=+r.value&&a>=+t.value&&e.classList.remove("hide-rating")}))}fillColor(e,t,r){const a=+e.value/+e.max*100,c=+t.value/+e.max*100;r.style.background=`linear-gradient(to right, #dadae5 ${a}%\n\n      , #9b8d64 ${a}% , #9b8d64 ${c}%, #dadae5 ${c}%)`}addToCart(e,t){var r;!Object.keys(this.cart).length&&e?this.cart[e]=1:Object.keys(this.cart).length&&e&&this.cart[e]?this.cart[e]=0:Object.values(this.cart).reduce(((e,t)=>e+t))<20?this.cart[e]&&0!=this.cart[e]||(this.cart[e]=1):(alert("Sorry, all slots are full"),null===(r=t.closest(".card"))||void 0===r||r.classList.remove("cards__item_checked")),localStorage.setItem("cart",JSON.stringify(this.cart))}checkCart(){const e=localStorage.getItem("cart");e&&(this.cart=JSON.parse(e)),this.showMiniCart(),document.querySelectorAll(".card").forEach((e=>{const t=e.getAttribute("data-id");this.cart[t]&&0!=this.cart[t]&&e.classList.add("cards__item_checked")}))}showMiniCart(){let e=0;const t=document.querySelector(".mini-cart__counter");for(const t in this.cart)e+=this.cart[t];t.textContent=String(e)}search(){document.querySelector(".search__input").addEventListener("input",(function(){const e=this.value.toLowerCase().trim();document.querySelectorAll(".card").forEach((t=>{const r=t.querySelector(".card__name").textContent.search(e);""!==e&&-1==r?t.classList.add("hide-search"):t.classList.remove("hide-search")}))}))}reset(){const e=document.getElementById("filters"),t=document.getElementById("search"),r=document.querySelector(".filter__reset-btn"),a=document.querySelector(".filter__clear-btn");null==r||r.addEventListener("click",(()=>{t.reset(),null==e||e.reset()})),null==a||a.addEventListener("click",(()=>{localStorage.clear(),location.reload()}))}saveSettings(){const e=document.getElementById("filters"),t={};[...e.elements].forEach((e=>{"checkbox"!=e.type&&(t[e.id]=e.value),"range"!=e.type&&"text"!=e.type&&(t[e.id]=e.checked)})),localStorage.setItem("form",JSON.stringify(t))}loadSettings(){const e=document.getElementById("filters"),t=JSON.parse(localStorage.getItem("form"));t&&([...e.elements].forEach((e=>{"checkbox"!=e.type&&(e.value=t[e.id],"range"!=e.type&&"text"!=e.type&&(e.checked=t[e.id],t[e.id]&&this.sortByCheckbox(e,e.getAttribute("id").split("-")[0])))})),this.initSlider("price"),this.initSlider("rating"))}}},130:function(e,t,r){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=a(r(647));r(608),t.default=c.default}},t={};function r(a){var c=t[a];if(void 0!==c)return c.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,r),s.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(607)})();